README for LocStream RedistStore Test
-------------------------------------

This reproducer is designed to reproduce the scalability issue occuring
during the FieldBundleRedistStore call when calculating the RouteHandle
between two sets of fields built on arbitrarily distributed LocStreams.

The issue was discovered while running a test case with 5 million
arbitrarily distributed points being redistributed from 1024 processors
to 32 processors.

The number of PETs allocated to the applicaiton (nPETs) is divided
between model1 and model2 such that model2 is given 2PETS+(nPETs/50)+
(nPETs/100). The remaining PETs are given to model1.

The application is configurable at build time.
  ESMF_TRACE   - write events to traceout when regions are entered or
                 exited (default=ON).
  ESMF_TRACEIO - wrap file and mpi calls with trace regions
                 (default=OFF).
  NPOINTS      - Number of points to be redistributed from model1 to 
                 model2 (default=5000000).
  NFIELDS      - Number of fields to be redistributed from model1 to
                 model2 (default=40).
  NGAPS        - Number of index gaps spread out over NPOINTS.
                 (default=50000).
  REDIST       - Redistribute from model1 to model2 (default=ON).
  CONTIGUOUS   - Distribute the points in contiguous blocks
                 (default=OFF).
  DEBUG        - Include extra debugging print statements (default=OFF).

Dependencies:
  - ESMF with LocStream Reconcile Fix (branch fb_on_ls_reconcile_fix)
      * ESMF v8.0.0 beta snapshot TBD
  
Build:
  - Set environment variable ESMFMKFILE to point to the esmf.mk of your ESMF
    installation.
  - gmake [ESMF_TRACE=ON/OFF] [ESMF_TRACEIO=OFF/ON] [NPOINTS=#] [NFIELDS=#]
    [NGAPS=#] [REDIST=ON/OFF] [CONTIGUOUS=ON/OFF] [DEBUG=OFF/ON]
  
Execution:
  - Modify the Portable Batch System(PBS) template script, qsub_template.sh.
  - Optionally set environment variable ESMF_RUNTIME_COMPLIANCECHECK to ON.
  - Optionally set environment variable ESMF_RUNTIME_TRACE to OFF. 
  - Submit a job to the PBS job scheduler, qsub qsub_script.sh
    Or call mpiexec -n X ./esmTest.exe (where X is the number of mpi tasks.)
  
Output:
  - PET*.Log files containing compliance checker output if turned on.
  - The application outputs model status information to stdout.

Code structure:
  - Makefile           - Makefile that is based on the standard esmf.mk
                         mechanism.
  - user_coupler.F90   - The "fieldbundle data" coupling component.
  - user_model1.F90    - The "fieldbundle data" source component.
  - user_model2.F90    - The "fieldbundle data" destination component.
  - esmTest.F90        - The Earth System Model (ESM) component, which
                         creates, initializes, runs, and finalizes the
                         user components.

